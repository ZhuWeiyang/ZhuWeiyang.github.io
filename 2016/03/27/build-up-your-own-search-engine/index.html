<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python,搜索引擎," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="基于Python，通过爬虫、页面索引、PageRank、相关性分析，建立一个原始的搜索引擎模型。">
<meta property="og:type" content="article">
<meta property="og:title" content="建立一个搜索引擎模型">
<meta property="og:url" content="http://www.xzwy.space/2016/03/27/build-up-your-own-search-engine/index.html">
<meta property="og:site_name" content="Weiyang's blog">
<meta property="og:description" content="基于Python，通过爬虫、页面索引、PageRank、相关性分析，建立一个原始的搜索引擎模型。">
<meta property="og:updated_time" content="2016-03-29T03:01:37.270Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="建立一个搜索引擎模型">
<meta name="twitter:description" content="基于Python，通过爬虫、页面索引、PageRank、相关性分析，建立一个原始的搜索引擎模型。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>

  <title> 建立一个搜索引擎模型 | Weiyang's blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <!-- hexo-inject:begin --><!-- hexo-inject:end --><script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?76cf9645ef40b79ba084d8674c441c18";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Weiyang's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">我有一只小狗汪汪汪...</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                建立一个搜索引擎模型
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-27T20:25:16+08:00" content="2016-03-27">
              2016-03-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/小项目/" itemprop="url" rel="index">
                    <span itemprop="name">小项目</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>老师说要做一个搜索引擎的模型…嗯，从来没干过。正好借此机会熟悉一下强大的Python和好用的爬虫框架，折腾了两天（踩了不少坑，让我哭一会…），终于有个原型实现了。</p>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><h2 id="安装Python2-7"><a href="#安装Python2-7" class="headerlink" title="安装Python2.7"></a>安装Python2.7</h2><p>上<a href="https://www.python.org/" target="_blank" rel="external">Python官网</a>，选择对应的系统版本，下载安装。应该没什么坑，安装完毕在终端输入<code>python</code>，如果显示<code>Python 2.7.x</code>字样就说明正确安装了，否则请检查环境变量是否配置正确。<br><strong>Python2和Python3共存：</strong>如需共存，则将二者都加入环境变量，并把Python3目录下的Python重命名为Python3即可。</p>
<h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><p>下面需要用到以下依赖包：</p>
<blockquote>
<p>scrapy&nbsp;&nbsp;# 爬虫框架<br>numpy&nbsp;&nbsp;# 矩阵计算<br>flask&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Web框架<br>sqlite3&nbsp;&nbsp;# 数据库（Python2.5以上似乎自带了，可以不装）</p>
</blockquote>
<p>请在终端下依次执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ pip install scrapy</span><br><span class="line">$ pip install numpy</span><br><span class="line">$ pip install flask</span><br><span class="line">$ pip install sqlite3</span><br></pre></td></tr></table></figure></p>
<p><strong>注意：</strong>如果遇到pip安装失败，可以更换为阿里pypi源，具体配置方法参见<a href="http://mirrors.aliyun.com/help/pypi" target="_blank" rel="external">阿里Pypi Help</a>和<a href="https://pip.pypa.io/en/latest/user_guide/#configuration" target="_blank" rel="external">官方文档</a>。</p>
<h1 id="爬虫实现"><a href="#爬虫实现" class="headerlink" title="爬虫实现"></a>爬虫实现</h1><p>实现搜索引擎模型十分关键的一步是完成爬虫脚本的编写，为搜索引擎提供网页数据。借助<strong>Scrapy</strong>框架，可以很轻松的完成这项工作。详细文档请参考<a href="http://doc.scrapy.org/en/latest/" target="_blank" rel="external">Scrapy documentation</a>，下面只列出和解释本例中所用到的一些技术。</p>
<h2 id="创建爬虫项目"><a href="#创建爬虫项目" class="headerlink" title="创建爬虫项目"></a>创建爬虫项目</h2><p>在终端下进入需要存储代码的目录，并运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy startproject cstspider</span><br></pre></td></tr></table></figure>
<p>然后<code>scrapy</code>会自动创建出一个爬虫项目cstspider，其目录结构大致如下：</p>
<pre>
cstspider/
&nbsp;&nbsp;&nbsp;&nbsp;scrapy.cfg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 爬虫部署配置文件
&nbsp;&nbsp;&nbsp;&nbsp;cstspider/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Python项目模块
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__init__.py
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;items.py&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 项目Items文件
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipelines.py&nbsp;&nbsp;# 项目Pipelines文件
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;settings.py&nbsp;&nbsp;&nbsp;# 项目配置文件
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spiders/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 存放自行实现的爬虫
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__init__.py
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
</pre>

<h2 id="定义爬虫数据存放的Item"><a href="#定义爬虫数据存放的Item" class="headerlink" title="定义爬虫数据存放的Item"></a>定义爬虫数据存放的Item</h2><p>修改items.py文件，自行定义爬虫数据存放的域：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CstspiderItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    title = scrapy.Field()    <span class="comment"># 存放网页标题</span></span><br><span class="line">    url = scrapy.Field()      <span class="comment"># 存放网页完整url地址</span></span><br><span class="line">    content = scrapy.Field()  <span class="comment"># 存放网页文字内容</span></span><br><span class="line">    links = scrapy.Field()    <span class="comment"># 存放网页中包含的超链接地址列表</span></span><br></pre></td></tr></table></figure></p>
<h2 id="编写爬虫主程序"><a href="#编写爬虫主程序" class="headerlink" title="编写爬虫主程序"></a>编写爬虫主程序</h2><p>在spider目录下创建cstspider.py文件，在其中编写爬虫主程序：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> .. <span class="keyword">import</span> items</span><br><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line"><span class="keyword">import</span> lxml.etree</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CstSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">"cstspider"</span></span><br><span class="line">    allowed_domains = [<span class="string">"www.cst.zju.edu.cn"</span>]</span><br><span class="line">    start_urls = [<span class="string">"http://www.cst.zju.edu.cn/index.php"</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 获得纯文本</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_plain_text</span><span class="params">(self, body)</span>:</span></span><br><span class="line">        root = lxml.html.fromstring(body)</span><br><span class="line">        <span class="comment"># 去除掉注释，&lt;scrpit&gt; &lt;head&gt; 标签部分</span></span><br><span class="line">        lxml.etree.strip_elements(root, lxml.etree.Comment, <span class="string">"script"</span>, <span class="string">"head"</span>)</span><br><span class="line">        text = lxml.html.tostring(root, method=<span class="string">"text"</span>, encoding=unicode)</span><br><span class="line">        <span class="comment"># 去除\t \r \n 和空格</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.join(text.split())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="comment"># 利用之前定义的Item处理数据</span></span><br><span class="line">        item = items.CstspiderItem()</span><br><span class="line">        item[<span class="string">'title'</span>] = response.css(<span class="string">"head &gt; title::text"</span>).extract_first()</span><br><span class="line">        item[<span class="string">'url'</span>] = response.url</span><br><span class="line">        item[<span class="string">'content'</span>] = self.get_plain_text(response.body)</span><br><span class="line">        item[<span class="string">'links'</span>] = []</span><br><span class="line">        <span class="keyword">for</span> href <span class="keyword">in</span> response.css(<span class="string">"a::attr('href')"</span>):</span><br><span class="line">            url = response.urljoin(href.extract())</span><br><span class="line">			item[<span class="string">'links'</span>].append(url)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url, callback=self.parse)</span><br><span class="line">        <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>name</code>为爬虫的名字</li>
<li><code>allowed_domains</code>为爬虫的爬取域</li>
<li><code>start_urls</code>为爬虫的起始页面</li>
</ul>
<p>在终端切换到爬虫项目cstspider的根目录，执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scrapy crawl cstspider</span><br></pre></td></tr></table></figure></p>
<p>就可以启动爬虫，从<code>start_urls</code>指定的页面开始爬取数据，并始终限制在<code>allowed_domains</code>指定的域中。当爬虫从<code>start_urls</code>爬取到数据后，就会调用parse函数来处理数据。在这里使用了预先定义的Item来存放网页信息。</p>
<p><code>scrapy</code>基于<code>lxml</code>实现了<a href="https://www.w3.org/TR/selectors/" target="_blank" rel="external">CSS选择器</a>和<a href="https://www.w3.org/TR/xpath/" target="_blank" rel="external">XPath选择器</a>，利用选择器可以很轻松的提取网页中，指定元素所包含的数据。详细的选择器文档请参考<a href="http://doc.scrapy.org/en/latest/topics/selectors.html#topics-selectors" target="_blank" rel="external">这里</a>。</p>
<p>本例中使用了基于CSS的选择器，<code>response.css(&quot;head &gt; title::text&quot;)</code>选择了<code>&lt;head&gt;</code>标签中的<code>&lt;title&gt;</code>，来提取网页标题信息。extract_first()表示提取第一个匹配的项。也可以使用for..in..来遍历选择出的所有元素，<code>for href in response.css(&quot;a::attr(&#39;href&#39;)&quot;):</code>遍历了网页中所有的<code>&lt;a&gt;</code>标签，提取了url信息。使用<code>response.urljoin()</code>方法将其转化为完整的url地址，存入item[‘links’]中。</p>
<p>对于页面上的所有链接，调用<code>scrapy.Request(url, callback=self.parse)</code>方法依次访问，回调函数仍然指定为<code>parse</code>，用于保存数据和处理链接。<code>scrapy</code>内部实现了<strong>URL去重</strong>，所以不必担心循环爬取的问题，直接放心提交链接即可。</p>
<p>由于爬虫在指定域内不断爬取和产生新的链接，所以如果不手动停止爬虫，爬虫将在爬取完整站以后才会停止。<br>那么问题来了：<strong>怎么才能在爬取指定数量的页面后自动停止爬虫？</strong>Google一番还没有找到正确解答，不过似乎和Extension和Stats Collection有关。</p>
<h2 id="爬虫数据库设计"><a href="#爬虫数据库设计" class="headerlink" title="爬虫数据库设计"></a>爬虫数据库设计</h2><p>为了组织和保存爬虫获取的数据，首先要对数据库进行设计。本例采用SQLite3作为数据库，设计了<code>content</code>表和<code>map</code>表分别存储爬取的网页数据和页面之间的超链接关系。</p>
<p><strong>Table</strong> content</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">约束</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">PRIMARY KEY AUTOINCREMENT</td>
<td style="text-align:center">网页的Id</td>
</tr>
<tr>
<td style="text-align:center">url</td>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">无</td>
<td style="text-align:center">网页的完整url</td>
</tr>
<tr>
<td style="text-align:center">title</td>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">无</td>
<td style="text-align:center">网页的标题</td>
</tr>
<tr>
<td style="text-align:center">content</td>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">无</td>
<td style="text-align:center">网页的内容</td>
</tr>
</tbody>
</table>
<p><strong>Table</strong> map</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">约束</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">PRIMARY KEY AUTOINCREMENT</td>
<td style="text-align:center">关系的Id</td>
</tr>
<tr>
<td style="text-align:center">src</td>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">无</td>
<td style="text-align:center">源网页完整url</td>
</tr>
<tr>
<td style="text-align:center">dst</td>
<td style="text-align:center">TEXT</td>
<td style="text-align:center">无</td>
<td style="text-align:center">目标网页完整url</td>
</tr>
</tbody>
</table>
<h2 id="保存爬取数据"><a href="#保存爬取数据" class="headerlink" title="保存爬取数据"></a>保存爬取数据</h2><p>在爬虫实现过程中，使用了Item保存爬取的数据，但并没有将其持久化。想要实现Item的持久化，需要借助基于<strong>责任链模式</strong>设计的Pipeline。在<code>pipelines.py</code>中实现自己的持久化方式，本例中将数据写入了SQLite3数据库中，详细的Python下SQLite的使用方法参见<a href="http://www.runoob.com/sqlite/sqlite-python.html" target="_blank" rel="external">SQLite教程</a>。下面给出本例中的Pipeline实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CstspiderPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    conn = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.conn = sqlite3.connect(<span class="string">'../database/cstzju.db'</span>)</span><br><span class="line">        sql = <span class="string">'''CREATE TABLE IF NOT EXISTS [content] (</span><br><span class="line">                 [id] INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">                 [url] TEXT,</span><br><span class="line">                 [title] TEXT,</span><br><span class="line">                 [content] TEXT);</span><br><span class="line">              '''</span></span><br><span class="line">        self.conn.execute(sql)</span><br><span class="line">        sql = <span class="string">'''CREATE TABLE IF NOT EXISTS [map] (</span><br><span class="line">                  [id] INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">                  [src] TEXT,</span><br><span class="line">                  [dst] TEXT);</span><br><span class="line">              '''</span></span><br><span class="line">        self.conn.execute(sql)</span><br><span class="line">        sql = <span class="string">'''CREATE UNIQUE INDEX IF NOT EXISTS [unirec] ON [map] ([src], [dst]);'''</span></span><br><span class="line">        self.conn.execute(sql)</span><br><span class="line">        self.conn.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self, spider)</span>:</span></span><br><span class="line">        self.conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        cursor = self.conn.cursor()</span><br><span class="line">        cursor.execute(<span class="string">'''INSERT INTO [content]([url], [title], [content]) VALUES(?, ?, ?);'''</span>,</span><br><span class="line">					  (item[<span class="string">"url"</span>],item[<span class="string">"title"</span>],item[<span class="string">"content"</span>]))</span><br><span class="line">        <span class="keyword">for</span> dst <span class="keyword">in</span> item[<span class="string">"links"</span>]:</span><br><span class="line">            cursor.execute(<span class="string">'''INSERT OR IGNORE INTO [map]([src],[dst]) VALUES(?,?);'''</span>, (item[<span class="string">"url"</span>], dst))</span><br><span class="line">        self.conn.commit()</span><br><span class="line">        cursor.close()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>open_spider(self,spider)</code>函数在爬虫开启时被调用，通常可以将持久化准备的过程（例如打开数据库连接）放入其中执行。</li>
<li><code>close_spider(self,spider)</code>函数在爬虫关闭的时候被调用，通常可以将持久化收尾的过程（例如关闭数据库连接）放入其中执行。</li>
<li><code>process_item(self,item,spider)</code>函数用于处理数据，在数据产生时被调用。该函数必须返回<code>Item</code>供下一个Pipeline使用或者抛出<code>DropItem</code>异常丢弃这个Item。</li>
</ul>
<p><strong>注意：</strong>编写好自己的Pipeline后需要在<code>settings.py</code>文件中启用它，在该文件中加入如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">	&apos;cstspider.pipelines.CstspiderPipeline&apos;: 300,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>数值300代表Pipeline的优先级。可以在其中定义多个Pipeline，优先级值的范围是0-1000，数字越小级别越高。</p>
<h1 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h1><p>本例实现的模拟搜索引擎不涉及中文分词问题，而是根据爬取内容人工选定了30个搜索关键词。根据关键词建立索引，并计算了相关性。同时实现了一个简易版本的PageRank算法。</p>
<h2 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h2><p>设网页总数为$N$，关键词总数为$M$。对于每一个关键词建立倒排索引<span>$P_{m}=(p_{m1},p_{m2},\cdots,p_{mN})$</span><!-- Has MathJax -->，其中<span>$p_{ij}\in\left \{0,1  \right \}, i\in\left\{1,2,\cdots,M\right\}, j\in\left\{1,2,\cdots,N\right\}$</span><!-- Has MathJax -->。如果网页$j$包含第$i$个关键词，则<span>$p_{ij}=1$</span><!-- Has MathJax -->，否则<span>$p_{ij}=0$</span><!-- Has MathJax -->。对于每个输入关键词<span>$w_{i}$</span><!-- Has MathJax -->，可以将对应的倒排索引相与后求出包含输入关键字的网页。</p>
<h2 id="简易PageRank算法"><a href="#简易PageRank算法" class="headerlink" title="简易PageRank算法"></a>简易PageRank算法</h2><p>定义页面间相互连接关系为：<br><span>$$A=\left[\begin{array}{ccccc}
&Tab;&Tab;a_{11} &amp; \cdots &amp; a_{1n} &amp; \cdots &amp; a_{1N}\\
&Tab;&Tab;\cdots &amp;        &amp;        &amp;        &amp; \cdots\\
&Tab;&Tab;a_{n1} &amp; \cdots &amp; a_{nn} &amp; \cdots &amp; a_{nN}\\
&Tab;&Tab;\cdots &amp;        &amp;        &amp;        &amp; \cdots\\
&Tab;&Tab;a_{N1} &amp; \cdots &amp; a_{Nn} &amp; \cdots &amp; a_{NN}\\
&Tab;&Tab;\end{array}\right]$$</span><!-- Has MathJax --><br>其中<span>$a_{ij}=1$</span><!-- Has MathJax -->表示网页$i$中包含到网页$j$的超链接，否则<span>$a_{ij}=0$</span><!-- Has MathJax -->。<br>定义网页排名为：<br><span>$$B=\left[\begin{array}{ccccc}
&Tab;&Tab;b_{1} &amp; b_{2} &amp; b_{3} &amp; \cdots &amp; b_{N}
  \end{array}\right]^{\rm T}$$</span><!-- Has MathJax --><br>可以通过迭代法逐渐逼近得到近似的网页排名$B$，取初值<span>$B_{0}=\left[\begin{array}{cccc} \frac{1}{N} &amp; \frac{1}{N} &amp; \cdots &amp; \frac{1}{N} \end{array}\right]^{\rm T}$</span><!-- Has MathJax -->。利用以下迭代公式逐渐逼近$B$，本例中迭代次数取10，小常数$\alpha = 0.001$：<br><span>$$B_{i}=\left[
&Tab;&Tab;&Tab; \frac{\alpha}{N} \cdot I + \left( 1 - \alpha \right) \cdot A 
&Tab;  \right] \cdot B_{i-1}$$</span><!-- Has MathJax --><br>基于<code>Python 2</code>的<code>numpy</code>库实现如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_pagerank</span><span class="params">()</span>:</span></span><br><span class="line">    alpha = <span class="number">0.001</span></span><br><span class="line">    <span class="comment"># g是一个已经包含网页间连接信息的邻接数组</span></span><br><span class="line">    A = np.array(g, dtype=int)</span><br><span class="line">    B = np.ones((N, <span class="number">1</span>), dtype=float)</span><br><span class="line">    I = np.identity(N, dtype=int)</span><br><span class="line">    <span class="comment"># 定义初值均为1/N</span></span><br><span class="line">    B *= (<span class="number">1.0</span> / N)</span><br><span class="line">    <span class="comment"># 迭代10次</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        B = np.dot((alpha/N*I+(<span class="number">1</span>-alpha)*A),B)</span><br><span class="line">    <span class="keyword">return</span> B</span><br></pre></td></tr></table></figure></p>
<h2 id="相关性分析"><a href="#相关性分析" class="headerlink" title="相关性分析"></a>相关性分析</h2><p>为了度量输入关键词和网页信息之间的相关性，可以使用如下方法进行相关性分析。定义输入关键词为：<span>$w_{1}, w_{2}, \cdots, w_{N}$</span><!-- Has MathJax -->，它们在某个网页中的词频定义为<span>${\rm TF}_{1}, {\rm TF}_{2}, \cdots, {\rm TF}_{N}$</span><!-- Has MathJax -->。词频可按照如下方式计算：<br>
$${\rm TF}_{i}=\frac{{\rm Count}\left(P,w_{i}\right)}{{\rm Len}\left(P\right)}$$
其中${\rm Count}\left(P,w_{i}\right)$表示关键词<span>$w_{i}$</span><!-- Has MathJax -->在页面$P$中出现的次数。${\rm Len}\left(P\right)$表示页面$P$的内容长度。</p>
<p>如果一个关键词只在很少的网页中出现，我们通过它就容易锁定搜索目标，它的权重也就应该大。反之如果一个词在大量网页中出现，我们看到它仍然不很清楚要找什么内容，因此它应该小。因此需要引入一个关键词权重来评判关键词的重要程度，最常用的权重是逆本文频率指数IDF,其计算方式如下：<br>
$${\rm IDF}_{i}={\rm log} \left( \frac{D}{D_{w_{i}}} \right)$$
其中<span>$D$</span><!-- Has MathJax -->表示全部网页数，$D_{w_{i}}$表示包含关键词<span>$w_{i}$</span><!-- Has MathJax -->的网页个数。<br>将上述词频公式加权求和就可以得到输入关键词<span>$w_{1}, w_{2}, \cdots, w_{N}$</span><!-- Has MathJax -->和网页$P$的相关程度<span>$R\left( w_{1},w_{2},\cdots,w_{N},P \right)$</span><!-- Has MathJax -->：<br>
$$R\left( w_{1},w_{2},\cdots,w_{N},P \right)=\sum_{i=1}^{N} {\rm TF}_{i}*{\rm IDF}_{i}$$
</p>
<p>在数据库中定义了如下的词频表wordcount：</p>
<p><strong>Table</strong> wordcount</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">约束</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">PRIMARY KEY AUTOINCREMENT</td>
<td style="text-align:center">词频的Id</td>
</tr>
<tr>
<td style="text-align:center">keyword_id</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">无</td>
<td style="text-align:center">关键词Id</td>
</tr>
<tr>
<td style="text-align:center">page_id</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">无</td>
<td style="text-align:center">包含关键词的网页Id</td>
</tr>
<tr>
<td style="text-align:center">count</td>
<td style="text-align:center">INTEGER</td>
<td style="text-align:center">无</td>
<td style="text-align:center">关键词出现的次数</td>
</tr>
</tbody>
</table>
<p>下面给出从数据获取数据并计算输入关键词和网页相关性的算法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># keyids  关键词Id列表</span></span><br><span class="line"><span class="comment"># pageid  网页id</span></span><br><span class="line"><span class="comment"># content 网页内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_relative</span><span class="params">(keyids, pageid, content)</span>:</span></span><br><span class="line">    rel = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> keyid <span class="keyword">in</span> keyids:</span><br><span class="line">        rv = query_db(<span class="string">'select [count] from [wordcount] where keyword_id=? and page_id=?;'</span>, (keyid,pageid), <span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">if</span> rv != <span class="keyword">None</span>:</span><br><span class="line">            rv2 = query_db(<span class="string">'select COUNT(*) from [wordcount] where keyword_id=? and count&gt;0;'</span>, (keyid,), <span class="keyword">True</span>)</span><br><span class="line">            tf = int(rv[<span class="number">0</span>])*<span class="number">1.0</span>/len(content)</span><br><span class="line">            dw = int(rv2[<span class="number">0</span>])</span><br><span class="line">            idf = log(<span class="number">1.0</span>*get_pagecount()/dw)</span><br><span class="line">            rel += tf * idf</span><br><span class="line">    <span class="keyword">return</span> rel</span><br></pre></td></tr></table></figure></p>
<h1 id="Web框架"><a href="#Web框架" class="headerlink" title="Web框架"></a>Web框架</h1><p>本例基于Python的轻量级Web框架Flask实现，下面直接以代码注释的形式讲解使用方式，其中数据库依然使用了SQLite3。详细使用方法请参照<a href="http://flask.pocoo.org/docs" target="_blank" rel="external">官方文档</a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库路径</span></span><br><span class="line">DATABASE = <span class="string">'../database/cstzju.db'</span></span><br><span class="line"><span class="comment"># 实例化flask</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得数据库连接</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db</span><span class="params">()</span>:</span></span><br><span class="line">    db = getattr(g, <span class="string">'_database'</span>, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> db <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        db = g._database = sqlite3.connect(DATABASE)</span><br><span class="line">    <span class="keyword">return</span> db</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在生命周期结束关闭数据库连接</span></span><br><span class="line"><span class="meta">@app.teardown_appcontext</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">close_connection</span><span class="params">(exception)</span>:</span></span><br><span class="line">    db = getattr(g, <span class="string">'_database'</span>, <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> db <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        db.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库查询方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">query_db</span><span class="params">(query, args=<span class="params">()</span>, one=False)</span>:</span></span><br><span class="line">    cur = get_db().execute(query, args)</span><br><span class="line">    rv = cur.fetchall()</span><br><span class="line">    cur.close()</span><br><span class="line">    <span class="keyword">return</span> (rv[<span class="number">0</span>] <span class="keyword">if</span> rv <span class="keyword">else</span> <span class="keyword">None</span>) <span class="keyword">if</span> one <span class="keyword">else</span> rv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 地址路由，在访问'/'转向该函数处理，返回渲染后的结果</span></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 列举数据库中预定义的关键词</span></span><br><span class="line">    keywords = []</span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> query_db(<span class="string">'select keyword from [keywords]'</span>):</span><br><span class="line">        keywords.append(keyword[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># 分别处理GET请求和POST请求</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="comment"># 通过模板渲染，将需要显示的参数传入进行渲染</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, keywords=keywords)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        searchkey = request.form[<span class="string">'search'</span>].strip()</span><br><span class="line">        <span class="keyword">if</span> searchkey != <span class="string">""</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'search.html'</span>, keywords=keywords,</span><br><span class="line">                      searchkey=searchkey, result=search(searchkey))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, keywords=keywords)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 监听所有IP地址，端口5000</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>
<p>模板页面渲染语法遵照<a href="http://jinja.pocoo.org" target="_blank" rel="external">jinja</a>，可以使用for，if等语法。以<code>index.html</code>模板页面为例，后台调用<code>render_template(&#39;index.html&#39;, keywords=keywords)</code>方法将keywords参数传入到需要渲染的页面，页面中使用for循环遍历list，输出每一个关键词的超链接，具体实现如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html;charset=UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>模拟搜索引擎<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"search"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"search"</span> <span class="attr">id</span>=<span class="string">"search"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; searchkey &#125;&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span>关键词：</span><br><span class="line">	&#123;%- for keyword in keywords -%&#125;</span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span>=<span class="string">"javascript:addkey(this);"</span> <span class="attr">href</span>=<span class="string">"javascript:void();"</span>&gt;</span>&#123;&#123;keyword&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">	&#123;% endfor %&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span>&gt;</span><span class="undefined"></span><br><span class="line">		function trim(str)&#123; //删除左右两端的空格</span><br><span class="line">			return str.replace(/(^\s*)|(\s*$)/g, "");</span><br><span class="line">		&#125;</span><br><span class="line">		function addkey(obj)&#123;</span><br><span class="line">			s = document.getElementById('search');</span><br><span class="line">			s.value = trim(s.value + ' ' + obj.innerHTML);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol>
<li><a href="http://scrapy.org/" target="_blank" rel="external">Scrapy</a></li>
<li><a href="http://www.numpy.org/" target="_blank" rel="external">Numpy</a></li>
<li><a href="http://flask.pocoo.org/" target="_blank" rel="external">flask</a></li>
<li><a href="https://docs.python.org/2/library/sqlite3.html" target="_blank" rel="external">SQLite3</a></li>
<li><a href="http://jinja.pocoo.org/" target="_blank" rel="external">Jinja</a></li>
</ol>

      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag">#Python</a>
          
            <a href="/tags/搜索引擎/" rel="tag">#搜索引擎</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/25/fix-installation-failed-of-scrapy-on-Windows/" rel="next" title="解决Python爬虫框架Scrapy在Windows上的安装问题">
                <i class="fa fa-chevron-left"></i> 解决Python爬虫框架Scrapy在Windows上的安装问题
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/04/13/news-classifier/" rel="prev" title="模拟新闻自动分类器">
                模拟新闻自动分类器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars1.githubusercontent.com/u/16204743?v=3&s=460"
               alt="Weiyang" />
          <p class="site-author-name" itemprop="name">Weiyang</p>
          <p class="site-description motion-element" itemprop="description">每天开开心心啦啦啦...</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ZhuWeiyang" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">我关注的小伙伴们</p>
            
              <span class="links-of-author-item">
                <a href="http://semicoder.xyz/" target="_blank">SemiCoder's Learning Logs</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://yodyu.github.io/" target="_blank">尤大鱼</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/pangjiuzala" target="_blank">XingLiu's Blog</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#背景"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境准备"><span class="nav-number">2.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Python2-7"><span class="nav-number">2.1.</span> <span class="nav-text">安装Python2.7</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装依赖包"><span class="nav-number">2.2.</span> <span class="nav-text">安装依赖包</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#爬虫实现"><span class="nav-number">3.</span> <span class="nav-text">爬虫实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建爬虫项目"><span class="nav-number">3.1.</span> <span class="nav-text">创建爬虫项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#定义爬虫数据存放的Item"><span class="nav-number">3.2.</span> <span class="nav-text">定义爬虫数据存放的Item</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写爬虫主程序"><span class="nav-number">3.3.</span> <span class="nav-text">编写爬虫主程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#爬虫数据库设计"><span class="nav-number">3.4.</span> <span class="nav-text">爬虫数据库设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保存爬取数据"><span class="nav-number">3.5.</span> <span class="nav-text">保存爬取数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据处理"><span class="nav-number">4.</span> <span class="nav-text">数据处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#建立索引"><span class="nav-number">4.1.</span> <span class="nav-text">建立索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简易PageRank算法"><span class="nav-number">4.2.</span> <span class="nav-text">简易PageRank算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#相关性分析"><span class="nav-number">4.3.</span> <span class="nav-text">相关性分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web框架"><span class="nav-number">5.</span> <span class="nav-text">Web框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Weiyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  
  
<script type="text/javascript" src="/js/src/scrollspy.js?v=0.5.0"></script>

<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = NexT.utils.escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    NexT.motion.middleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');

      if (CONFIG.scheme !== 'Pisces' && (CONFIG.sidebar.display === 'post' || CONFIG.sidebar.display === 'always')) {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          NexT.utils.displaySidebar();
        }
      }
    };
  });
</script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML-full">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  



  



  
  
  

  


</body>
</html>
